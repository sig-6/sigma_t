<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGMA SIX | Premium DApp</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #00ffcc;
            --secondary: #9d4edd;
            --bg: #0a0b10;
            --card: #161821;
            --text: #ffffff;
            --border: #2d2f3e;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4d4d;
            --gradient: linear-gradient(90deg, #00ffcc, #9d4edd, #ff2a6d, #00ffcc);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        .crypto-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                linear-gradient(90deg, rgba(0,255,204,0.03) 1px, transparent 1px) 0 0 / 50px 50px,
                linear-gradient(0deg, rgba(157,78,221,0.03) 1px, transparent 1px) 0 0 / 50px 50px;
            animation: bgMove 20s linear infinite;
        }
        
        @keyframes bgMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 100px 100px, 100px 100px; }
        }
        
        .crypto-lines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0.15;
        }
        
        .crypto-line {
            position: absolute;
            background: linear-gradient(90deg, transparent, var(--primary), var(--secondary), transparent);
            height: 1px;
            width: 200%;
            animation: lineMove 15s linear infinite;
        }
        
        .crypto-line:nth-child(1) { top: 10%; left: -100%; transform: rotate(45deg); animation-delay: 0s; }
        .crypto-line:nth-child(2) { top: 20%; left: -100%; transform: rotate(-45deg); animation-delay: 2s; }
        .crypto-line:nth-child(3) { top: 30%; left: -100%; transform: rotate(60deg); animation-delay: 4s; }
        .crypto-line:nth-child(4) { top: 40%; left: -100%; transform: rotate(-60deg); animation-delay: 6s; }
        .crypto-line:nth-child(5) { top: 50%; left: -100%; transform: rotate(30deg); animation-delay: 8s; }
        .crypto-line:nth-child(6) { top: 60%; left: -100%; transform: rotate(-30deg); animation-delay: 10s; }
        .crypto-line:nth-child(7) { top: 70%; left: -100%; transform: rotate(75deg); animation-delay: 12s; }
        .crypto-line:nth-child(8) { top: 80%; left: -100%; transform: rotate(-75deg); animation-delay: 14s; }
        
        @keyframes lineMove {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .crypto-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary);
            border-radius: 50%;
            animation: particleFloat 20s linear infinite;
            opacity: 0.3;
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-100vh) translateX(100px); opacity: 0; }
        }
        
        .rainbow-border {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient);
            background-size: 400% 400%;
            animation: rainbow 8s ease infinite;
            z-index: 1000;
        }
        
        .rainbow-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(157,78,221,0.15) 0%, rgba(0,255,204,0.1) 25%, rgba(0,11,16,0) 70%);
            border-radius: 50%;
            z-index: -1;
            animation: pulse 6s ease-in-out infinite alternate;
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; transform: translate(-50%, -50%) scale(0.9); }
            100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.1); }
        }
        
        .ticker-container {
            background: rgba(10, 11, 16, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 255, 204, 0.2);
            padding: 10px 0;
            overflow: hidden;
            position: relative;
            z-index: 10;
        }
        
        .ticker-wrapper {
            display: flex;
            width: max-content;
            animation: ticker 30s linear infinite;
        }
        
        @keyframes ticker {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        .ticker-item {
            display: flex;
            align-items: center;
            margin: 0 30px;
            white-space: nowrap;
        }
        
        .ticker-symbol {
            font-weight: 700;
            font-size: 14px;
            color: var(--primary);
            margin-right: 8px;
        }
        
        .ticker-price {
            font-weight: 600;
            font-size: 14px;
        }
        
        .ticker-change {
            font-weight: 600;
            font-size: 12px;
            margin-left: 8px;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .positive {
            color: var(--success);
            background: rgba(0, 255, 136, 0.1);
        }
        
        .negative {
            color: var(--danger);
            background: rgba(255, 77, 77, 0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            position: relative;
            z-index: 1;
        }
        
        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
            }
        }
        
        .left-panel, .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .connect-btn {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: #000;
            border: none;
            border-radius: 15px;
            padding: 16px 30px;
            font-weight: 800;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 20px rgba(0, 255, 204, 0.3);
            animation: float 4s ease-in-out infinite;
        }
        
        @keyframes float {
            0%,100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .connect-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 204, 0.5);
        }
        
        .connect-btn.connected {
            background: rgba(0, 255, 204, 0.1);
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .main-card {
            background: rgba(22, 24, 33, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 30px;
            border: 1px solid rgba(0, 255, 204, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        
        .main-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient);
            background-size: 400% 400%;
            animation: rainbow 8s ease infinite;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            background: var(--gradient);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 42px;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 8px;
            animation: rainbow 8s ease infinite;
        }
        
        .header p {
            color: #aaa;
            font-size: 14px;
            letter-spacing: 1px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(45, 47, 62, 0.5);
            transition: all 0.3s;
        }
        
        .stat-box:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 255, 204, 0.1);
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .stat-value {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-value-inr {
            font-size: 14px;
            color: #aaa;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px;
            border-radius: 16px;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            color: #666;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .tab.active {
            background: var(--primary);
            color: #000;
            box-shadow: 0 4px 15px rgba(0, 255, 204, 0.3);
        }
        
        .input-area {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .input-area:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 255, 204, 0.1);
        }
        
        .input-header {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #888;
            margin-bottom: 12px;
        }
        
        input {
            background: transparent;
            border: none;
            color: white;
            font-size: 32px;
            width: 100%;
            outline: none;
            font-weight: 600;
        }
        
        .calc-box {
            background: rgba(0, 255, 204, 0.05);
            border: 1px dashed var(--primary);
            border-radius: 16px;
            padding: 20px;
            font-size: 14px;
            margin-bottom: 20px;
            min-height: 100px;
        }
        
        .row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .empty-row {
            color: #666;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        
        .action-btn {
            width: 100%;
            padding: 20px;
            border-radius: 16px;
            border: none;
            font-weight: 800;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            text-transform: uppercase;
            background: var(--gradient);
            background-size: 400% 400%;
            color: #000;
            animation: rainbow 8s ease infinite;
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 255, 204, 0.4);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        #status-msg {
            font-size: 13px;
            text-align: center;
            margin-top: 15px;
            color: var(--primary);
            font-weight: 600;
            min-height: 20px;
        }
        
        .ref-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
            margin-top: 25px;
            transition: all 0.3s;
        }
        
        .ref-box.hidden {
            display: none;
        }
        
        .ref-box.visible {
            display: block;
        }
        
        .contract-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--secondary);
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .contract-info {
            flex: 1;
        }
        
        .contract-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .contract-address {
            font-size: 14px;
            color: var(--secondary);
            font-family: monospace;
            word-break: break-all;
        }
        
        .copy-btn {
            background: linear-gradient(90deg, var(--secondary), #7b2cbf);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .copy-btn:hover {
            background: linear-gradient(90deg, #7b2cbf, var(--secondary));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 78, 221, 0.3);
        }
        
        .balance-footer {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            font-size: 14px;
        }
        
        .balance-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .balance-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .balance-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .balance-inr {
            font-size: 12px;
            color: #ffaa00;
            font-weight: 600;
            margin-top: 2px;
        }
        
        .menu-card {
            background: rgba(22, 24, 33, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 30px;
            border: 1px solid rgba(157, 78, 221, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }
        
        .menu-card h2 {
            color: var(--secondary);
            font-size: 24px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }
        
        .menu-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(157, 78, 221, 0.3);
            border-radius: 16px;
            padding: 18px;
            color: white;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
            text-align: left;
        }
        
        .menu-btn i {
            font-size: 20px;
            color: var(--secondary);
        }
        
        .menu-btn:hover {
            background: rgba(157, 78, 221, 0.1);
            border-color: var(--secondary);
            transform: translateX(5px);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .main-card, .menu-card {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 32px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            input {
                font-size: 26px;
            }
            
            .contract-box {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            
            .copy-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Professional Crypto Background -->
    <div class="crypto-bg"></div>
    <div class="crypto-lines">
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
        <div class="crypto-line"></div>
    </div>
    <div class="crypto-particles" id="cryptoParticles"></div>
    
    <!-- Rainbow Border -->
    <div class="rainbow-border"></div>
    <div class="rainbow-glow"></div>
    
    <!-- Live Tickers -->
    <div class="ticker-container">
        <div class="ticker-wrapper">
            <div class="ticker-item">
                <span class="ticker-symbol">BTC</span>
                <span class="ticker-price">$68,421.50</span>
                <span class="ticker-change positive">+2.34%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">ETH</span>
                <span class="ticker-price">$3,812.75</span>
                <span class="ticker-change positive">+1.78%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">USDT</span>
                <span class="ticker-price">$1.00</span>
                <span class="ticker-change">0.00%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">SOL</span>
                <span class="ticker-price">$142.60</span>
                <span class="ticker-change negative">-0.85%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">BNB</span>
                <span class="ticker-price">$585.30</span>
                <span class="ticker-change positive">+0.92%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">SIG6</span>
                <span class="ticker-price" id="ticker-sig6-price">--</span>
                <span class="ticker-change" id="ticker-sig6-change">--</span>
            </div>
            <!-- Duplicate for seamless looping -->
            <div class="ticker-item">
                <span class="ticker-symbol">BTC</span>
                <span class="ticker-price">$68,421.50</span>
                <span class="ticker-change positive">+2.34%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">ETH</span>
                <span class="ticker-price">$3,812.75</span>
                <span class="ticker-change positive">+1.78%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">USDT</span>
                <span class="ticker-price">$1.00</span>
                <span class="ticker-change">0.00%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">SOL</span>
                <span class="ticker-price">$142.60</span>
                <span class="ticker-change negative">-0.85%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">BNB</span>
                <span class="ticker-price">$585.30</span>
                <span class="ticker-change positive">+0.92%</span>
            </div>
            <div class="ticker-item">
                <span class="ticker-symbol">SIG6</span>
                <span class="ticker-price" id="ticker-sig6-price-dup">--</span>
                <span class="ticker-change" id="ticker-sig6-change-dup">--</span>
            </div>
        </div>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Left Panel -->
        <div class="left-panel">
            <button class="connect-btn" id="connectBtn" onclick="connectWallet()">
                <i class="fas fa-wallet"></i> Connect Wallet
            </button>
            
            <div class="main-card">
                <div class="header">
                    <h1>SIGMA SIX</h1>
                    <p>Stable Algorithm • 5-Level Rewards</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-label"><i class="fas fa-arrow-up"></i> BUY RATE</div>
                        <div id="brate" class="stat-value">--</div>
                        <div id="brate-inr" class="stat-value-inr">--</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label"><i class="fas fa-arrow-down"></i> SELL RATE</div>
                        <div id="srate" class="stat-value">--</div>
                        <div id="srate-inr" class="stat-value-inr">--</div>
                    </div>
                </div>
                
                <div class="tabs">
                    <div id="t-buy" class="tab active" onclick="setMode('buy')">
                        <i class="fas fa-shopping-cart"></i> BUY SIG6
                    </div>
                    <div id="t-sell" class="tab" onclick="setMode('sell')">
                        <i class="fas fa-coins"></i> SELL SIG6
                    </div>
                </div>
                
                <div class="input-area">
                    <div class="input-header">
                        <span>Amount in SIG6</span>
                        <span style="color:var(--primary);cursor:pointer" onclick="max()">
                            <i class="fas fa-maximize"></i> MAX
                        </span>
                    </div>
                    <input type="number" id="amt" placeholder="0" value="" oninput="calc()" onkeyup="calc()">
                </div>
                
                <div class="calc-box" id="calcBox">
                    <div class="empty-row" id="emptyMessage">
                        <i class="fas fa-arrow-up"></i> Enter amount to calculate
                    </div>
                    <div id="calcContent" style="display: none;">
                        <div class="row">
                            <span id="out-label">Total USDT to Pay:</span> 
                            <span id="out-amt" style="color:var(--primary); font-weight:800">0.0000 USDT</span>
                        </div>
                        <div class="row">
                            <span>Equivalent INR:</span> 
                            <span id="inr-amt" style="color:#ffaa00">0.00 INR</span>
                        </div>
                        <div class="row" id="upline-display">
                            <span style="color:#888;">Upline Address:</span> 
                            <span id="upline-addr" style="font-size:11px; color:#aaa;">None</span>
                        </div>
                    </div>
                </div>
                
                <button class="action-btn" id="mainBtn" onclick="action()" disabled>
                    <i class="fas fa-lock"></i> CONNECT WALLET FIRST
                </button>
                <div id="status-msg">Connect wallet to start trading</div>
                
                <!-- Contract Address Box -->
                <div class="contract-box">
                    <div class="contract-info">
                        <div class="contract-label">
                            <i class="fas fa-file-contract"></i> SIGMA SIX CONTRACT ADDRESS
                        </div>
                        <div class="contract-address" id="contract-addr">
                            0xeA0a8150c5B368ec026ffB094FCfCdB3FaBFa479
                        </div>
                    </div>
                    <button class="copy-btn" onclick="copyContract()">
                        <i class="fas fa-copy"></i> COPY
                    </button>
                </div>
                
                <!-- Referral Box - Dynamic show/hide based on user type -->
                <div class="ref-box hidden" id="ref-ui">
                    <div class="row">
                        <span style="font-size:12px; color:#888;">
                            <i class="fas fa-link"></i> YOUR REFERRAL LINK
                        </span>
                        <button onclick="copyRef()" style="background:var(--primary); border:none; border-radius:10px; padding:8px 16px; font-weight:800; font-size:12px; cursor:pointer; display:flex; align-items:center; gap:8px">
                            <i class="fas fa-copy"></i> COPY LINK
                        </button>
                    </div>
                    <input type="text" id="ref-link" readonly style="display:none;">
                </div>
                
                <div class="balance-footer">
                    <div class="balance-item">
                        <span><i class="fas fa-wallet"></i> USDT Balance:</span>
                        <div class="balance-info">
                            <span id="bal-usdt">--</span>
                        </div>
                    </div>
                    <div class="balance-item">
                        <span><i class="fas fa-coins"></i> SIG6 Balance:</span>
                        <div class="balance-info">
                            <span id="bal-sig">--</span>
                            <span id="bal-sig-inr" class="balance-inr">--</span>
                        </div>
                    </div>
                    <div class="balance-item">
                        <span><i class="fas fa-gas-pump"></i> POL Balance:</span>
                        <div class="balance-info">
                            <span id="bal-pol">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Panel -->
        <div class="right-panel">
            <div class="menu-card">
                <h2><i class="fas fa-bars"></i> SIGMA SIX MENU</h2>
                <div class="menu-grid">
                    <button class="menu-btn" onclick="window.location.href='team.html'">
                        <i class="fas fa-users"></i>
                        <div>
                            <div>Team</div>
                            <div style="font-size:12px; color:#aaa;">View referral team & earnings</div>
                        </div>
                    </button>
                    <button class="menu-btn" onclick="window.location.href='income.html'">
                        <i class="fas fa-chart-line"></i>
                        <div>
                            <div>Income Report</div>
                            <div style="font-size:12px; color:#aaa;">Track your rewards & commissions</div>
                        </div>
                    </button>
                    <button class="menu-btn" onclick="window.location.href='buy_sell.html'">
                        <i class="fas fa-exchange-alt"></i>
                        <div>
                            <div>Buy/Sell Report</div>
                            <div style="font-size:12px; color:#aaa;">Transaction history & analytics</div>
                        </div>
                    </button>
                    <button class="menu-btn" onclick="window.location.href='tree.html'">
                        <i class="fas fa-project-diagram"></i>
                        <div>
                            <div>Tree View</div>
                            <div style="font-size:12px; color:#aaa;">Visualize your referral network</div>
                        </div>
                    </button>
                    <button class="menu-btn" onclick="window.location.href='details.html'">
                        <i class="fas fa-rocket"></i>
                        <div>
                            <div>Explore Sigma</div>
                            <div style="font-size:12px; color:#aaa;">Learn about SIGMA SIX ecosystem</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== UPDATED CONTRACT CONFIGURATION =====
        const S_ADDR = "0xeA0a8150c5B368ec026ffB094FCfCdB3FaBFa479";
        const U_ADDR = "0xc2132D05D31c914a87C6611C10748AEb04B58e8F"; // USDT on Polygon
        const CREATOR_WALLET = "0xb579377DDe2C03b2b46B5b12453F4dbAddB06f2E";
        
        // SigmaSix Contract ABI (minimal for speed)
        const SIGMA_SIX_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function upline(address) view returns (address)",
            "function buyRate() view returns (uint256)",
            "function getSellRate() view returns (uint256)",
            "function hasBoughtBefore(address) view returns (bool)",
            "function buySigma(uint256,address) returns ()",
            "function sellSigma(uint256) returns ()",
            {
                "anonymous": false,
                "inputs": [
                    {"indexed": true, "name": "user", "type": "address"},
                    {"indexed": true, "name": "referrer", "type": "address"},
                    {"indexed": false, "name": "timestamp", "type": "uint256"}
                ],
                "name": "MemberJoined",
                "type": "event"
            }
        ];

        let mode = 'buy', buyR = 0, sellR = 0, signer, addr, provider;
        const USDT_TO_INR = 95.0;
        let isWalletConnected = false;
        
        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('cryptoParticles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 20}s`;
                particle.style.backgroundColor = i % 3 === 0 ? 'var(--primary)' : 
                                                i % 3 === 1 ? 'var(--secondary)' : 
                                                '#ff2a6d';
                particlesContainer.appendChild(particle);
            }
        }
        
        // Save Referral Upline from URL
        function handleUpline() {
            const params = new URLSearchParams(window.location.search);
            let ref = params.get('ref');
            if (ref && ethers.isAddress(ref)) {
                localStorage.setItem('sigma_ref', ref);
            }
            let currentRef = localStorage.getItem('sigma_ref') || "0x0000000000000000000000000000000000000000";
            document.getElementById('upline-addr').innerText = currentRef.slice(0,10) + "..." + currentRef.slice(-8);
            return currentRef;
        }

        function updateINRValues() {
            if (!isWalletConnected) return;
            
            document.getElementById('brate-inr').innerText = `≈ ₹${(buyR * USDT_TO_INR).toFixed(2)} INR`;
            document.getElementById('srate-inr').innerText = `≈ ₹${(sellR * USDT_TO_INR).toFixed(2)} INR`;
            
            const outAmtElement = document.getElementById('out-amt');
            if (outAmtElement) {
                const outAmtText = outAmtElement.innerText;
                const outAmt = parseFloat(outAmtText) || 0;
                document.getElementById('inr-amt').innerText = `${(outAmt * USDT_TO_INR).toFixed(2)} INR`;
            }
        }

        function updateSigmaINRValue() {
            if (!isWalletConnected) return;
            
            const sigBalanceElement = document.getElementById('bal-sig');
            const sigINRElement = document.getElementById('bal-sig-inr');
            
            if (sigBalanceElement && sigINRElement) {
                const sigText = sigBalanceElement.innerText;
                const sigBalance = parseFloat(sigText) || 0;
                const inrValue = (sigBalance * sellR * USDT_TO_INR).toFixed(2);
                sigINRElement.innerText = `₹${inrValue} INR`;
            }
        }

        function updateAllINRValues() {
            updateINRValues();
            updateSigmaINRValue();
        }

        function updateTickers() {
            if (!isWalletConnected || buyR === 0) {
                document.querySelectorAll('[id^="ticker-sig6-price"]').forEach(el => {
                    el.innerText = '--';
                });
                document.querySelectorAll('[id^="ticker-sig6-change"]').forEach(el => {
                    el.innerText = '--';
                });
                return;
            }
            
            const changePercent = ((buyR - 0.0316) / 0.0316 * 100).toFixed(2);
            const sig6Price = buyR.toFixed(4);
            
            document.querySelectorAll('[id^="ticker-sig6-price"]').forEach(el => {
                el.innerText = `$${sig6Price}`;
            });
            
            document.querySelectorAll('[id^="ticker-sig6-change"]').forEach(el => {
                const changeClass = parseFloat(changePercent) >= 0 ? 'positive' : 'negative';
                el.className = `ticker-change ${changeClass}`;
                el.innerText = `${parseFloat(changePercent) >= 0 ? '+' : ''}${changePercent}%`;
            });
        }

        function copyContract() {
            const contractAddress = "0xeA0a8150c5B368ec026ffB094FCfCdB3FaBFa479";
            navigator.clipboard.writeText(contractAddress).then(() => {
                const statusMsg = document.getElementById('status-msg');
                statusMsg.innerText = "Contract Address Copied!";
                statusMsg.style.color = "#9d4edd";
                
                const copyBtn = document.querySelector('.copy-btn');
                const originalHTML = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> COPIED';
                copyBtn.style.background = 'linear-gradient(90deg, #00ff88, #00cc66)';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalHTML;
                    copyBtn.style.background = 'linear-gradient(90deg, var(--secondary), #7b2cbf)';
                    
                    setTimeout(() => {
                        statusMsg.innerText = isWalletConnected ? "Ready to trade" : "Connect wallet to start trading";
                        statusMsg.style.color = isWalletConnected ? "#00ffcc" : "#ffaa00";
                    }, 2000);
                }, 1500);
            });
        }

        async function connectWallet() {
            if (!window.ethereum) {
                alert("Please install MetaMask to use this DApp!");
                window.open("https://metamask.io/download/", "_blank");
                return;
            }
            
            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                addr = accounts[0];
                signer = await provider.getSigner();
                
                isWalletConnected = true;
                
                const connectBtn = document.getElementById('connectBtn');
                connectBtn.innerHTML = `<i class="fas fa-check-circle"></i> ${addr.slice(0,6)}...${addr.slice(-4)}`;
                connectBtn.classList.add('connected');
                
                document.getElementById('mainBtn').disabled = false;
                document.getElementById('mainBtn').innerHTML = '<i class="fas fa-lock"></i> APPROVE USDT';
                
                document.getElementById('status-msg').innerText = "Wallet Connected Successfully!";
                document.getElementById('status-msg').style.color = "#00ff88";
                
                await sync();
                
                window.ethereum.on('accountsChanged', async (accounts) => {
                    if (accounts.length > 0) {
                        addr = accounts[0];
                        signer = await provider.getSigner();
                        connectBtn.innerHTML = `<i class="fas fa-check-circle"></i> ${addr.slice(0,6)}...${addr.slice(-4)}`;
                        await sync();
                    } else {
                        isWalletConnected = false;
                        connectBtn.innerHTML = '<i class="fas fa-wallet"></i> Connect Wallet';
                        connectBtn.classList.remove('connected');
                        document.getElementById('ref-ui').classList.add('hidden');
                        document.getElementById('mainBtn').disabled = true;
                        document.getElementById('mainBtn').innerHTML = '<i class="fas fa-lock"></i> CONNECT WALLET FIRST';
                        document.getElementById('status-msg').innerText = "Wallet Disconnected";
                        document.getElementById('status-msg').style.color = "#ffaa00";
                        
                        // Reset all displays
                        document.getElementById('brate').innerText = '--';
                        document.getElementById('srate').innerText = '--';
                        document.getElementById('brate-inr').innerText = '--';
                        document.getElementById('srate-inr').innerText = '--';
                        document.getElementById('bal-usdt').innerText = '--';
                        document.getElementById('bal-sig').innerText = '--';
                        document.getElementById('bal-sig-inr').innerText = '--';
                        document.getElementById('bal-pol').innerText = '--';
                        
                        document.getElementById('amt').value = '';
                        document.getElementById('calcContent').style.display = 'none';
                        document.getElementById('emptyMessage').style.display = 'block';
                        
                        updateTickers();
                    }
                });
                
                window.ethereum.on('chainChanged', () => {
                    window.location.reload();
                });
                
            } catch (error) {
                console.error("Connection error:", error);
                document.getElementById('status-msg').innerText = "Connection failed: " + (error.message || "Unknown error");
                document.getElementById('status-msg').style.color = "#ff4d4d";
            }
        }

        async function sync() {
            if (!addr || !isWalletConnected) return;
            
            try {
                const uc = new ethers.Contract(U_ADDR, [
                    "function balanceOf(address) view returns (uint256)",
                    "function allowance(address,address) view returns (uint256)"
                ], provider);
                
                const sc = new ethers.Contract(S_ADDR, SIGMA_SIX_ABI, provider);
                
                const [pb, ub, sb, br, sr, alw, hasBought] = await Promise.all([
                    provider.getBalance(addr),
                    uc.balanceOf(addr),
                    sc.balanceOf(addr),
                    sc.buyRate(),
                    sc.getSellRate(),
                    uc.allowance(addr, S_ADDR),
                    sc.hasBoughtBefore(addr)
                ]);

                const polBalance = parseFloat(ethers.formatEther(pb)).toFixed(3);
                const usdtBalance = parseFloat(ethers.formatUnits(ub, 6)).toFixed(3);
                const sigBalance = parseFloat(ethers.formatEther(sb)).toFixed(2);
                
                document.getElementById('bal-pol').innerText = polBalance + " POL";
                document.getElementById('bal-usdt').innerText = usdtBalance + " USDT";
                document.getElementById('bal-sig').innerText = sigBalance + " SIG6";
                
                // ===== REFERRAL LINK LOGIC =====
                // Case 1: Migrated User (has balance but never bought)
                if (sigBalance > 0 && !hasBought) {
                    console.log("✅ Migrated user - showing referral link");
                    document.getElementById('ref-ui').classList.remove('hidden');
                    document.getElementById('ref-ui').classList.add('visible');
                    updateRefLink();
                }
                // Case 2: Joined User (has bought before)
                else if (hasBought) {
                    console.log("✅ Joined user - showing referral link");
                    document.getElementById('ref-ui').classList.remove('hidden');
                    document.getElementById('ref-ui').classList.add('visible');
                    updateRefLink();
                }
                // Case 3: New User (no balance, never bought)
                else {
                    console.log("❌ New user - hiding referral link");
                    document.getElementById('ref-ui').classList.add('hidden');
                    document.getElementById('ref-ui').classList.remove('visible');
                }
                
                // Convert rates from contract (6 decimals) to human readable
                const newBuyR = parseFloat(ethers.formatUnits(br, 6));
                const newSellR = parseFloat(ethers.formatUnits(sr, 6));
                
                buyR = newBuyR;
                sellR = newSellR;
                
                document.getElementById('brate').innerText = buyR.toFixed(4) + " USDT";
                document.getElementById('srate').innerText = sellR.toFixed(4) + " USDT";
                
                updateAllINRValues();
                updateTickers();
                
                const v = parseFloat(document.getElementById('amt').value) || 0;
                if (v > 0) {
                    const sigmaAmount = ethers.parseEther(v.toString());
                    const buyRateFromContract = ethers.parseUnits(buyR.toFixed(6), 6);
                    
                    // Contract uses: (sigmaAmount * buyRate) / 10**18
                    const totalCostUsdt = (sigmaAmount * buyRateFromContract) / BigInt("1000000000000000000");
                    const requiredUsdt = totalCostUsdt + (totalCostUsdt / 100n);
                    
                    const currentAlw = ethers.formatUnits(alw, 6);
                    const requiredUsdtFormatted = ethers.formatUnits(requiredUsdt, 6);

                    if(mode === 'buy') {
                        document.getElementById('mainBtn').innerHTML = (parseFloat(currentAlw) >= parseFloat(requiredUsdtFormatted) && parseFloat(requiredUsdtFormatted) > 0) 
                            ? '<i class="fas fa-shopping-cart"></i> BUY SIGMA' 
                            : '<i class="fas fa-lock"></i> APPROVE USDT';
                    } else {
                        document.getElementById('mainBtn').innerHTML = '<i class="fas fa-coins"></i> SELL SIGMA';
                    }
                }
                
                calc();
            } catch (e) { 
                console.error(e);
                document.getElementById('status-msg').innerText = "Sync Error: " + (e.reason || "Check connection");
                document.getElementById('status-msg').style.color = "#ff4d4d";
            }
        }

        function calc() {
            if (!isWalletConnected) {
                document.getElementById('calcContent').style.display = 'none';
                document.getElementById('emptyMessage').style.display = 'block';
                document.getElementById('emptyMessage').innerHTML = '<i class="fas fa-plug"></i> Connect wallet first';
                return;
            }
            
            const v = parseFloat(document.getElementById('amt').value) || 0;
            
            if (v <= 0) {
                document.getElementById('calcContent').style.display = 'none';
                document.getElementById('emptyMessage').style.display = 'block';
                document.getElementById('emptyMessage').innerHTML = '<i class="fas fa-arrow-up"></i> Enter amount to calculate';
                return;
            }
            
            document.getElementById('calcContent').style.display = 'block';
            document.getElementById('emptyMessage').style.display = 'none';
            
            if (mode === 'buy') {
                // Contract uses: (sigmaAmount * buyRate) / 10**18
                const sigmaAmount = ethers.parseEther(v.toString());
                const buyRateFromContract = ethers.parseUnits(buyR.toFixed(6), 6);
                const totalCostRaw = (sigmaAmount * buyRateFromContract) / BigInt("1000000000000000000");
                
                // Convert to number with 6 decimals (USDT)
                const totalCostFloat = Number(totalCostRaw) / 1e6;
                
                document.getElementById('out-label').innerText = "Total USDT to Pay:";
                document.getElementById('out-amt').innerText = totalCostFloat.toFixed(4) + " USDT";
            } else {
                // For sell
                const sigmaAmount = ethers.parseEther(v.toString());
                const sellRateFromContract = ethers.parseUnits(sellR.toFixed(6), 6);
                const totalUsdtRaw = (sigmaAmount * sellRateFromContract) / BigInt("1000000000000000000");
                const totalVal = Number(totalUsdtRaw) / 1e6;
                
                document.getElementById('out-label').innerText = "Total USDT to Receive:";
                document.getElementById('out-amt').innerText = totalVal.toFixed(4) + " USDT";
            }
            
            updateINRValues();
        }

        function setMode(m) {
            mode = m;
            document.getElementById('t-buy').className = m === 'buy' ? 'tab active' : 'tab';
            document.getElementById('t-sell').className = m === 'sell' ? 'tab active' : 'tab';
            
            if (isWalletConnected) {
                if (m === 'buy') {
                    document.getElementById('mainBtn').innerHTML = '<i class="fas fa-lock"></i> APPROVE USDT';
                } else {
                    document.getElementById('mainBtn').innerHTML = '<i class="fas fa-coins"></i> SELL SIGMA';
                }
            }
            
            calc();
        }

        async function action() {
            if (!signer) return connectWallet();
            
            const v = document.getElementById('amt').value;
            if (!v || v <= 0) {
                document.getElementById('status-msg').innerText = "Please enter a valid amount";
                document.getElementById('status-msg').style.color = "#ffaa00";
                return;
            }
            
            const msg = document.getElementById('status-msg');
            msg.style.color = "#00ffcc";
            
            try {
                if (mode === 'buy') {
                    const uc = new ethers.Contract(U_ADDR, [
                        "function approve(address,uint256) returns (bool)",
                        "function allowance(address,address) view returns (uint256)"
                    ], signer);
                    
                    // Exact calculation matching contract formula
                    const sigmaAmount = ethers.parseEther(v);
                    const buyRateFromContract = ethers.parseUnits(buyR.toFixed(6), 6);
                    
                    // Contract uses: (sigmaAmount * buyRate) / 10**18
                    const totalCostUsdt = (sigmaAmount * buyRateFromContract) / BigInt("1000000000000000000");
                    const buyTax = totalCostUsdt / 100n;
                    const requiredUsdt = totalCostUsdt + buyTax;
                    
                    const alw = await uc.allowance(addr, S_ADDR);
                    const currentAlw = Number(alw) / 1e6;
                    const requiredUsdtFormatted = Number(requiredUsdt) / 1e6;
                    
                    if (currentAlw < requiredUsdtFormatted) {
                        msg.innerText = "Approving USDT...";
                        
                        // Approve exact amount
                        const approveTx = await uc.approve(S_ADDR, requiredUsdt);
                        await approveTx.wait();
                        
                        msg.innerText = "Approval Success!";
                        msg.style.color = "#00ff88";
                        sync();
                        
                        setTimeout(() => {
                            document.getElementById('mainBtn').innerHTML = '<i class="fas fa-shopping-cart"></i> BUY SIGMA';
                        }, 1000);
                    } else {
                        const sc = new ethers.Contract(S_ADDR, SIGMA_SIX_ABI, signer);
                        const upline = handleUpline();
                        msg.innerText = "Buying SIGMA...";
                        
                        // Call contract with sigmaAmount
                        const tx = await sc.buySigma(sigmaAmount, upline, {
                            gasLimit: 500000
                        });
                        await tx.wait();
                        
                        msg.innerText = "Purchase Successful!";
                        msg.style.color = "#00ff88";
                        
                        // After successful buy, check if user now qualifies for referral link
                        const hasBoughtNow = await sc.hasBoughtBefore(addr);
                        if (hasBoughtNow) {
                            document.getElementById('ref-ui').classList.remove('hidden');
                            document.getElementById('ref-ui').classList.add('visible');
                            updateRefLink();
                        }
                        
                        sync();
                    }
                } else {
                    const sc = new ethers.Contract(S_ADDR, SIGMA_SIX_ABI, signer);
                    msg.innerText = "Selling SIGMA...";
                    
                    const sigmaAmount = ethers.parseEther(v);
                    const tx = await sc.sellSigma(sigmaAmount, {
                        gasLimit: 500000
                    });
                    await tx.wait();
                    
                    msg.innerText = "Sale Successful!";
                    msg.style.color = "#00ff88";
                    sync();
                }
            } catch (e) { 
                console.error(e);
                msg.innerText = "Error: " + (e.reason || e.message || "Check Balance/Gas");
                msg.style.color = "#ff4d4d";
            }
        }

        function updateRefLink() {
            if (!addr) return;
            const link = window.location.origin + window.location.pathname + "?ref=" + addr;
            document.getElementById('ref-link').value = link;
        }

        function copyRef() {
            const linkInput = document.getElementById('ref-link');
            linkInput.select();
            navigator.clipboard.writeText(linkInput.value);
            
            const statusMsg = document.getElementById('status-msg');
            statusMsg.innerText = "Referral Link Copied to Clipboard!";
            statusMsg.style.color = "#00ff88";
            
            setTimeout(() => {
                statusMsg.innerText = "Ready to trade";
                statusMsg.style.color = "#00ffcc";
            }, 3000);
        }

        function max() {
            if (!isWalletConnected) {
                connectWallet();
                return;
            }
            
            const u = document.getElementById('bal-usdt').innerText.split(' ')[0];
            const s = document.getElementById('bal-sig').innerText.split(' ')[0];
            
            if (mode === 'buy') {
                const usdtBalance = parseFloat(u) || 0;
                // Formula: sigma = usdtBalance / buyR
                const maxSigma = (usdtBalance / buyR).toFixed(2);
                document.getElementById('amt').value = maxSigma > 0 ? maxSigma : 0;
            } else {
                document.getElementById('amt').value = s;
            }
            calc();
        }

        window.onload = async function() {
            document.getElementById('amt').value = '';
            
            createParticles();
            handleUpline();
            updateTickers();
            
            // Hide referral link initially
            document.getElementById('ref-ui').classList.add('hidden');
            
            if (window.ethereum) {
                try {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    const accounts = await provider.send("eth_accounts", []);
                    
                    if (accounts.length > 0) {
                        await connectWallet();
                    }
                } catch (error) {
                    console.error("Auto-connect error:", error);
                }
            }
            
            setInterval(() => {
                if (addr && isWalletConnected) {
                    sync();
                }
            }, 30000);
        };
    </script>
</body>
</html>
